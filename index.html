<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management System</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background-color: var(--secondary-color);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .logo span {
            color: var(--primary-color);
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 1.5rem;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        nav ul li a:hover, nav ul li a.active {
            background-color: var(--primary-color);
        }
        
        main {
            padding: 2rem 0;
            min-height: calc(100vh - 140px);
        }
        
        .section-title {
            margin-bottom: 1.5rem;
            color: var(--secondary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        input, select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .btn-danger {
            background-color: var(--accent-color);
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .status-available {
            color: var(--success-color);
            font-weight: 600;
        }
        
        .status-borrowed {
            color: var(--accent-color);
            font-weight: 600;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-buttons button {
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1.5rem;
            text-align: center;
        }
        
        .dashboard-card h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }
        
        .dashboard-card p {
            color: #666;
        }
        
        .hidden {
            display: none;
        }
        
        .alert {
            padding: 0.75rem 1.25rem;
            margin-bottom: 1rem;
            border: 1px solid transparent;
            border-radius: 4px;
        }
        
        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        
        .alert-danger {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        
        footer {
            background-color: var(--secondary-color);
            color: white;
            text-align: center;
            padding: 1rem 0;
            margin-top: 2rem;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin-top: 1rem;
                justify-content: center;
            }
            
            nav ul li {
                margin: 0 0.5rem;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">Library<span>Manager</span></div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-target="dashboard">Dashboard</a></li>
                        <li><a href="#" class="nav-link" data-target="books">Books</a></li>
                        <li><a href="#" class="nav-link" data-target="members">Members</a></li>
                        <li><a href="#" class="nav-link" data-target="transactions">Transactions</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section">
            <h2 class="section-title">Dashboard</h2>
            <div class="dashboard-cards">
                <div class="dashboard-card">
                    <h3 id="total-books">0</h3>
                    <p>Total Books</p>
                </div>
                <div class="dashboard-card">
                    <h3 id="total-members">0</h3>
                    <p>Total Members</p>
                </div>
                <div class="dashboard-card">
                    <h3 id="borrowed-books">0</h3>
                    <p>Books Borrowed</p>
                </div>
                <div class="dashboard-card">
                    <h3 id="available-books">0</h3>
                    <p>Books Available</p>
                </div>
            </div>
            
            <div class="card">
                <h3>Recent Transactions</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Book</th>
                            <th>Member</th>
                            <th>Issue Date</th>
                            <th>Return Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="recent-transactions">
                        <!-- Recent transactions will be populated here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Books Section -->
        <section id="books" class="section hidden">
            <h2 class="section-title">Book Management</h2>
            
            <div class="card">
                <h3>Add New Book</h3>
                <form id="book-form">
                    <div class="form-group">
                        <label for="book-title">Title</label>
                        <input type="text" id="book-title" required>
                    </div>
                    <div class="form-group">
                        <label for="book-author">Author</label>
                        <input type="text" id="book-author" required>
                    </div>
                    <div class="form-group">
                        <label for="book-isbn">ISBN</label>
                        <input type="text" id="book-isbn" required>
                    </div>
                    <div class="form-group">
                        <label for="book-category">Category</label>
                        <input type="text" id="book-category" required>
                    </div>
                    <div class="form-group">
                        <label for="book-copies">Number of Copies</label>
                        <input type="number" id="book-copies" min="1" required>
                    </div>
                    <button type="submit" class="btn-success">Add Book</button>
                </form>
            </div>
            
            <div class="card">
                <h3>Book List</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Author</th>
                            <th>ISBN</th>
                            <th>Category</th>
                            <th>Available</th>
                            <th>Total</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="book-list">
                        <!-- Book list will be populated here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Members Section -->
        <section id="members" class="section hidden">
            <h2 class="section-title">Member Management</h2>
            
            <div class="card">
                <h3>Add New Member</h3>
                <form id="member-form">
                    <div class="form-group">
                        <label for="member-name">Full Name</label>
                        <input type="text" id="member-name" required>
                    </div>
                    <div class="form-group">
                        <label for="member-email">Email</label>
                        <input type="email" id="member-email" required>
                    </div>
                    <div class="form-group">
                        <label for="member-phone">Phone</label>
                        <input type="tel" id="member-phone" required>
                    </div>
                    <div class="form-group">
                        <label for="member-address">Address</label>
                        <input type="text" id="member-address" required>
                    </div>
                    <button type="submit" class="btn-success">Add Member</button>
                </form>
            </div>
            
            <div class="card">
                <h3>Member List</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Address</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="member-list">
                        <!-- Member list will be populated here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Transactions Section -->
        <section id="transactions" class="section hidden">
            <h2 class="section-title">Transaction Management</h2>
            
            <div class="card">
                <h3>Issue Book</h3>
                <form id="issue-form">
                    <div class="form-group">
                        <label for="issue-book">Select Book</label>
                        <select id="issue-book" required>
                            <option value="">Select a book</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="issue-member">Select Member</label>
                        <select id="issue-member" required>
                            <option value="">Select a member</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="issue-date">Issue Date</label>
                        <input type="date" id="issue-date" required>
                    </div>
                    <div class="form-group">
                        <label for="return-date">Return Date</label>
                        <input type="date" id="return-date" required>
                    </div>
                    <button type="submit" class="btn-success">Issue Book</button>
                </form>
            </div>
            
            <div class="card">
                <h3>Return Book</h3>
                <form id="return-form">
                    <div class="form-group">
                        <label for="return-transaction">Select Transaction</label>
                        <select id="return-transaction" required>
                            <option value="">Select a transaction</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-success">Return Book</button>
                </form>
            </div>
            
            <div class="card">
                <h3>Transaction History</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Book</th>
                            <th>Member</th>
                            <th>Issue Date</th>
                            <th>Return Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="transaction-list">
                        <!-- Transaction list will be populated here -->
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2023 Library Management System. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Data storage simulation (using localStorage)
        const LibraryDB = {
            // Initialize data if not exists
            init: function() {
                if (!localStorage.getItem('books')) {
                    localStorage.setItem('books', JSON.stringify([]));
                }
                if (!localStorage.getItem('members')) {
                    localStorage.setItem('members', JSON.stringify([]));
                }
                if (!localStorage.getItem('transactions')) {
                    localStorage.setItem('transactions', JSON.stringify([]));
                }
            },
            
            // Books operations
            getBooks: function() {
                return JSON.parse(localStorage.getItem('books'));
            },
            
            addBook: function(book) {
                const books = this.getBooks();
                book.id = Date.now().toString();
                books.push(book);
                localStorage.setItem('books', JSON.stringify(books));
                return book;
            },
            
            updateBook: function(id, updatedBook) {
                const books = this.getBooks();
                const index = books.findIndex(book => book.id === id);
                if (index !== -1) {
                    books[index] = {...books[index], ...updatedBook};
                    localStorage.setItem('books', JSON.stringify(books));
                    return books[index];
                }
                return null;
            },
            
            deleteBook: function(id) {
                const books = this.getBooks();
                const filteredBooks = books.filter(book => book.id !== id);
                localStorage.setItem('books', JSON.stringify(filteredBooks));
                return filteredBooks;
            },
            
            // Members operations
            getMembers: function() {
                return JSON.parse(localStorage.getItem('members'));
            },
            
            addMember: function(member) {
                const members = this.getMembers();
                member.id = Date.now().toString();
                members.push(member);
                localStorage.setItem('members', JSON.stringify(members));
                return member;
            },
            
            updateMember: function(id, updatedMember) {
                const members = this.getMembers();
                const index = members.findIndex(member => member.id === id);
                if (index !== -1) {
                    members[index] = {...members[index], ...updatedMember};
                    localStorage.setItem('members', JSON.stringify(members));
                    return members[index];
                }
                return null;
            },
            
            deleteMember: function(id) {
                const members = this.getMembers();
                const filteredMembers = members.filter(member => member.id !== id);
                localStorage.setItem('members', JSON.stringify(filteredMembers));
                return filteredMembers;
            },
            
            // Transactions operations
            getTransactions: function() {
                return JSON.parse(localStorage.getItem('transactions'));
            },
            
            addTransaction: function(transaction) {
                const transactions = this.getTransactions();
                transaction.id = Date.now().toString();
                transaction.status = 'borrowed';
                transactions.push(transaction);
                localStorage.setItem('transactions', JSON.stringify(transactions));
                return transaction;
            },
            
            updateTransaction: function(id, updatedTransaction) {
                const transactions = this.getTransactions();
                const index = transactions.findIndex(transaction => transaction.id === id);
                if (index !== -1) {
                    transactions[index] = {...transactions[index], ...updatedTransaction};
                    localStorage.setItem('transactions', JSON.stringify(transactions));
                    return transactions[index];
                }
                return null;
            },
            
            returnBook: function(id) {
                const transaction = this.updateTransaction(id, {status: 'returned'});
                return transaction;
            }
        };

        // UI Controller
        const LibraryUI = {
            currentSection: 'dashboard',
            
            init: function() {
                LibraryDB.init();
                this.setupEventListeners();
                this.showSection('dashboard');
                this.updateDashboard();
                this.renderBooks();
                this.renderMembers();
                this.renderTransactions();
                this.populateIssueForm();
            },
            
            setupEventListeners: function() {
                // Navigation
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const target = e.target.getAttribute('data-target');
                        this.showSection(target);
                    });
                });
                
                // Book form
                document.getElementById('book-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addBook();
                });
                
                // Member form
                document.getElementById('member-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addMember();
                });
                
                // Issue form
                document.getElementById('issue-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.issueBook();
                });
                
                // Return form
                document.getElementById('return-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.returnBook();
                });
            },
            
            showSection: function(sectionId) {
                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.add('hidden');
                });
                
                // Show selected section
                document.getElementById(sectionId).classList.remove('hidden');
                
                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('data-target') === sectionId) {
                        link.classList.add('active');
                    }
                });
                
                this.currentSection = sectionId;
                
                // Update specific section data if needed
                if (sectionId === 'dashboard') {
                    this.updateDashboard();
                } else if (sectionId === 'transactions') {
                    this.populateIssueForm();
                    this.populateReturnForm();
                }
            },
            
            updateDashboard: function() {
                const books = LibraryDB.getBooks();
                const members = LibraryDB.getMembers();
                const transactions = LibraryDB.getTransactions();
                
                // Update counts
                document.getElementById('total-books').textContent = books.length;
                document.getElementById('total-members').textContent = members.length;
                
                const borrowedBooks = transactions.filter(t => t.status === 'borrowed').length;
                document.getElementById('borrowed-books').textContent = borrowedBooks;
                
                const availableBooks = books.reduce((total, book) => total + (book.copies - (book.borrowed || 0)), 0);
                document.getElementById('available-books').textContent = availableBooks;
                
                // Update recent transactions
                this.renderRecentTransactions();
            },
            
            renderRecentTransactions: function() {
                const transactions = LibraryDB.getTransactions();
                const recentTransactions = transactions.slice(-5).reverse();
                const tbody = document.getElementById('recent-transactions');
                
                tbody.innerHTML = '';
                
                recentTransactions.forEach(transaction => {
                    const book = LibraryDB.getBooks().find(b => b.id === transaction.bookId);
                    const member = LibraryDB.getMembers().find(m => m.id === transaction.memberId);
                    
                    if (book && member) {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${book.title}</td>
                            <td>${member.name}</td>
                            <td>${transaction.issueDate}</td>
                            <td>${transaction.returnDate}</td>
                            <td class="status-${transaction.status}">${transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1)}</td>
                        `;
                        tbody.appendChild(row);
                    }
                });
            },
            
            renderBooks: function() {
                const books = LibraryDB.getBooks();
                const tbody = document.getElementById('book-list');
                
                tbody.innerHTML = '';
                
                books.forEach(book => {
                    const row = document.createElement('tr');
                    const available = book.copies - (book.borrowed || 0);
                    
                    row.innerHTML = `
                        <td>${book.title}</td>
                        <td>${book.author}</td>
                        <td>${book.isbn}</td>
                        <td>${book.category}</td>
                        <td>${available}</td>
                        <td>${book.copies}</td>
                        <td class="action-buttons">
                            <button class="btn-danger" onclick="LibraryUI.deleteBook('${book.id}')">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            },
            
            addBook: function() {
                const title = document.getElementById('book-title').value;
                const author = document.getElementById('book-author').value;
                const isbn = document.getElementById('book-isbn').value;
                const category = document.getElementById('book-category').value;
                const copies = parseInt(document.getElementById('book-copies').value);
                
                const book = {
                    title,
                    author,
                    isbn,
                    category,
                    copies,
                    borrowed: 0
                };
                
                LibraryDB.addBook(book);
                this.renderBooks();
                this.updateDashboard();
                this.populateIssueForm();
                
                // Reset form
                document.getElementById('book-form').reset();
                
                // Show success message
                this.showAlert('Book added successfully!', 'success');
            },
            
            deleteBook: function(id) {
                if (confirm('Are you sure you want to delete this book?')) {
                    LibraryDB.deleteBook(id);
                    this.renderBooks();
                    this.updateDashboard();
                    this.populateIssueForm();
                    this.showAlert('Book deleted successfully!', 'success');
                }
            },
            
            renderMembers: function() {
                const members = LibraryDB.getMembers();
                const tbody = document.getElementById('member-list');
                
                tbody.innerHTML = '';
                
                members.forEach(member => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${member.name}</td>
                        <td>${member.email}</td>
                        <td>${member.phone}</td>
                        <td>${member.address}</td>
                        <td class="action-buttons">
                            <button class="btn-danger" onclick="LibraryUI.deleteMember('${member.id}')">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            },
            
            addMember: function() {
                const name = document.getElementById('member-name').value;
                const email = document.getElementById('member-email').value;
                const phone = document.getElementById('member-phone').value;
                const address = document.getElementById('member-address').value;
                
                const member = {
                    name,
                    email,
                    phone,
                    address
                };
                
                LibraryDB.addMember(member);
                this.renderMembers();
                this.updateDashboard();
                this.populateIssueForm();
                
                // Reset form
                document.getElementById('member-form').reset();
                
                // Show success message
                this.showAlert('Member added successfully!', 'success');
            },
            
            deleteMember: function(id) {
                if (confirm('Are you sure you want to delete this member?')) {
                    LibraryDB.deleteMember(id);
                    this.renderMembers();
                    this.updateDashboard();
                    this.populateIssueForm();
                    this.showAlert('Member deleted successfully!', 'success');
                }
            },
            
            populateIssueForm: function() {
                const bookSelect = document.getElementById('issue-book');
                const memberSelect = document.getElementById('issue-member');
                
                // Clear existing options (except the first one)
                while (bookSelect.children.length > 1) {
                    bookSelect.removeChild(bookSelect.lastChild);
                }
                
                while (memberSelect.children.length > 1) {
                    memberSelect.removeChild(memberSelect.lastChild);
                }
                
                // Populate books
                const books = LibraryDB.getBooks();
                books.forEach(book => {
                    const available = book.copies - (book.borrowed || 0);
                    if (available > 0) {
                        const option = document.createElement('option');
                        option.value = book.id;
                        option.textContent = `${book.title} by ${book.author} (${available} available)`;
                        bookSelect.appendChild(option);
                    }
                });
                
                // Populate members
                const members = LibraryDB.getMembers();
                members.forEach(member => {
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = `${member.name} (${member.email})`;
                    memberSelect.appendChild(option);
                });
                
                // Set default dates
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('issue-date').value = today;
                
                const returnDate = new Date();
                returnDate.setDate(returnDate.getDate() + 14); // 2 weeks from today
                document.getElementById('return-date').value = returnDate.toISOString().split('T')[0];
            },
            
            populateReturnForm: function() {
                const transactionSelect = document.getElementById('return-transaction');
                
                // Clear existing options (except the first one)
                while (transactionSelect.children.length > 1) {
                    transactionSelect.removeChild(transactionSelect.lastChild);
                }
                
                // Populate borrowed transactions
                const transactions = LibraryDB.getTransactions();
                const borrowedTransactions = transactions.filter(t => t.status === 'borrowed');
                
                borrowedTransactions.forEach(transaction => {
                    const book = LibraryDB.getBooks().find(b => b.id === transaction.bookId);
                    const member = LibraryDB.getMembers().find(m => m.id === transaction.memberId);
                    
                    if (book && member) {
                        const option = document.createElement('option');
                        option.value = transaction.id;
                        option.textContent = `${book.title} - ${member.name} (Due: ${transaction.returnDate})`;
                        transactionSelect.appendChild(option);
                    }
                });
            },
            
            issueBook: function() {
                const bookId = document.getElementById('issue-book').value;
                const memberId = document.getElementById('issue-member').value;
                const issueDate = document.getElementById('issue-date').value;
                const returnDate = document.getElementById('return-date').value;
                
                if (!bookId || !memberId) {
                    this.showAlert('Please select both a book and a member!', 'danger');
                    return;
                }
                
                const transaction = {
                    bookId,
                    memberId,
                    issueDate,
                    returnDate
                };
                
                // Update book borrowed count
                const book = LibraryDB.getBooks().find(b => b.id === bookId);
                if (book) {
                    const available = book.copies - (book.borrowed || 0);
                    if (available <= 0) {
                        this.showAlert('No copies of this book are available!', 'danger');
                        return;
                    }
                    
                    book.borrowed = (book.borrowed || 0) + 1;
                    LibraryDB.updateBook(bookId, book);
                }
                
                LibraryDB.addTransaction(transaction);
                this.renderTransactions();
                this.updateDashboard();
                this.populateIssueForm();
                this.populateReturnForm();
                
                // Reset form
                document.getElementById('issue-form').reset();
                
                // Show success message
                this.showAlert('Book issued successfully!', 'success');
            },
            
            returnBook: function() {
                const transactionId = document.getElementById('return-transaction').value;
                
                if (!transactionId) {
                    this.showAlert('Please select a transaction!', 'danger');
                    return;
                }
                
                const transaction = LibraryDB.getTransactions().find(t => t.id === transactionId);
                if (transaction) {
                    // Update book borrowed count
                    const book = LibraryDB.getBooks().find(b => b.id === transaction.bookId);
                    if (book) {
                        book.borrowed = Math.max(0, (book.borrowed || 0) - 1);
                        LibraryDB.updateBook(book.id, book);
                    }
                    
                    LibraryDB.returnBook(transactionId);
                    this.renderTransactions();
                    this.updateDashboard();
                    this.populateIssueForm();
                    this.populateReturnForm();
                    
                    // Reset form
                    document.getElementById('return-form').reset();
                    
                    // Show success message
                    this.showAlert('Book returned successfully!', 'success');
                }
            },
            
            renderTransactions: function() {
                const transactions = LibraryDB.getTransactions();
                const tbody = document.getElementById('transaction-list');
                
                tbody.innerHTML = '';
                
                transactions.forEach(transaction => {
                    const book = LibraryDB.getBooks().find(b => b.id === transaction.bookId);
                    const member = LibraryDB.getMembers().find(m => m.id === transaction.memberId);
                    
                    if (book && member) {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${book.title}</td>
                            <td>${member.name}</td>
                            <td>${transaction.issueDate}</td>
                            <td>${transaction.returnDate}</td>
                            <td class="status-${transaction.status}">${transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1)}</td>
                            <td class="action-buttons">
                                ${transaction.status === 'borrowed' ? 
                                    `<button class="btn-success" onclick="LibraryUI.returnBookById('${transaction.id}')">Return</button>` : 
                                    ''}
                            </td>
                        `;
                        tbody.appendChild(row);
                    }
                });
            },
            
            returnBookById: function(transactionId) {
                // Set the return form to this transaction and submit
                document.getElementById('return-transaction').value = transactionId;
                this.returnBook();
            },
            
            showAlert: function(message, type) {
                // Create alert element
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.textContent = message;
                
                // Insert at the top of the current section
                const currentSection = document.getElementById(this.currentSection);
                currentSection.insertBefore(alert, currentSection.firstChild);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    alert.remove();
                }, 3000);
            }
        };

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            LibraryUI.init();
        });
    </script>
</body>
</html>
